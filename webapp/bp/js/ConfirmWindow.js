"use strict";

class ConfirmWindow extends ObjectFactory {
  /**
   * 构造函数
   * @param title 标题
   * @param width 宽度（单位：rem）
   */
  constructor(title, width) {
    ////////////////////////////////////////////////////////////////////////////
    // 父类构造函数。
    ////////////////////////////////////////////////////////////////////////////
    super();
    ////////////////////////////////////////////////////////////////////////////
    // 弹窗标题。
    ////////////////////////////////////////////////////////////////////////////
    this.windowTitle = title;
    ////////////////////////////////////////////////////////////////////////////
    // 弹窗的宽度。
    ////////////////////////////////////////////////////////////////////////////
    this.windowWidth = width;
  }

  /**
   * 生成代码
   */
  generateCode() {
    ////////////////////////////////////////////////////////////////////////////
    // 弹窗。
    ////////////////////////////////////////////////////////////////////////////
    this.popupWindow = new PopupWindow(this, this.windowTitle, this.windowWidth, this.popupWindowHideCallback);
    ////////////////////////////////////////////////////////////////////////////
    // 容器。
    ////////////////////////////////////////////////////////////////////////////
    this.container = new JSControl("div");
    ////////////////////////////////////////////////////////////////////////////
    // 结果信息标签。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel = new JSControl("label");
    ////////////////////////////////////////////////////////////////////////////
    // 内容标签。
    ////////////////////////////////////////////////////////////////////////////
    this.contentLabel = new JSControl("label");
    ////////////////////////////////////////////////////////////////////////////
    // 确认按钮。
    ////////////////////////////////////////////////////////////////////////////
    this.confirmButton = new JSControl("button");
    ////////////////////////////////////////////////////////////////////////////
    // 取消按钮。
    ////////////////////////////////////////////////////////////////////////////
    this.cancelButton = new JSControl("button");
    ////////////////////////////////////////////////////////////////////////////
    // 弹窗。
    ////////////////////////////////////////////////////////////////////////////
    this.popupWindow.setAttribute(
      {
        "class": "global_popup_window global_confirm_window"
      }
    );
    ////////////////////////////////////////////////////////////////////////////
    // 容器。
    ////////////////////////////////////////////////////////////////////////////
    this.container.setAttribute(
      {
        "class": "gcw_container"
      }
    );
    ////////////////////////////////////////////////////////////////////////////
    // 结果信息标签。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel.setAttribute(
      {
        "class": "global_label gcw_result_info_label"
      }
    );
    ////////////////////////////////////////////////////////////////////////////
    // 内容标签。
    ////////////////////////////////////////////////////////////////////////////
    this.contentLabel.setAttribute(
      {
        "class": "global_label gcw_content_label"
      }
    );
    ////////////////////////////////////////////////////////////////////////////
    // 确认按钮。
    ////////////////////////////////////////////////////////////////////////////
    this.confirmButton.setAttribute(
      {
        "class": "global_button_danger gcw_confirm_button"
      }
    );
    this.confirmButton.setContent("确认");
    ////////////////////////////////////////////////////////////////////////////
    // 取消按钮。
    ////////////////////////////////////////////////////////////////////////////
    this.cancelButton.setAttribute(
      {
        "class": "global_button_default gcw_cancel_button"
      }
    );
    this.cancelButton.setContent("取消");
    ////////////////////////////////////////////////////////////////////////////
    // 结果信息标签。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel.generateCode();
    ////////////////////////////////////////////////////////////////////////////
    // 内容标签。
    ////////////////////////////////////////////////////////////////////////////
    this.contentLabel.generateCode();
    ////////////////////////////////////////////////////////////////////////////
    // 确认按钮。
    ////////////////////////////////////////////////////////////////////////////
    this.confirmButton.generateCode();
    ////////////////////////////////////////////////////////////////////////////
    // 取消按钮。
    ////////////////////////////////////////////////////////////////////////////
    this.cancelButton.generateCode();
    ////////////////////////////////////////////////////////////////////////////
    // 容器。
    ////////////////////////////////////////////////////////////////////////////
    this.container.setContent(`
      ${this.resultInfoLabel.getCode()}
      ${this.contentLabel.getCode()}
      ${this.confirmButton.getCode() + this.cancelButton.getCode()}
    `);
    this.container.generateCode();
    ////////////////////////////////////////////////////////////////////////////
    // 弹窗。
    ////////////////////////////////////////////////////////////////////////////
    this.popupWindow.setContent(this.container.getCode());
    this.popupWindow.generateCode();
    ////////////////////////////////////////////////////////////////////////////
    // ObjectFactory的getCode返回的是objectCode，所以这里需要给objectC
    // ode赋值。
    ////////////////////////////////////////////////////////////////////////////
    this.objectCode = this.popupWindow.getCode();
  }

  /**
   * 初始化事件
   */
  initEvent() {
    ////////////////////////////////////////////////////////////////////////////
    // 初始化弹窗事件。
    ////////////////////////////////////////////////////////////////////////////
    this.popupWindow.initEvent();
    ////////////////////////////////////////////////////////////////////////////
    // 注册取消按钮的click事件。
    ////////////////////////////////////////////////////////////////////////////
    this.cancelButton.getObject().off("click").on("click", null, this, this.cancelButtonClickEvent);
  }

  /**
   * 弹窗隐藏回调方法
   * @param source 调用源
   */
  popupWindowHideCallback(source) {
    ////////////////////////////////////////////////////////////////////////////
    // 隐藏结果信息。
    ////////////////////////////////////////////////////////////////////////////
    source.hideResultInfo();
    ////////////////////////////////////////////////////////////////////////////
    // 显示内容标签。
    ////////////////////////////////////////////////////////////////////////////
    source.contentLabel.getObject().css("display", "block");
    ////////////////////////////////////////////////////////////////////////////
    // 显示确认按钮。
    ////////////////////////////////////////////////////////////////////////////
    source.confirmButton.getObject().css("display", "inline-block");
    ////////////////////////////////////////////////////////////////////////////
    // 重置取消按钮内容。
    ////////////////////////////////////////////////////////////////////////////
    source.cancelButton.getObject().html("取消");
  }

  /**
   * 取消按钮的click事件
   * @param event 事件对象
   */
  cancelButtonClickEvent(event) {
    const source = event.data;
    ////////////////////////////////////////////////////////////////////////////
    // 调用隐藏弹窗方法。
    ////////////////////////////////////////////////////////////////////////////
    source.hide();
  }

  /**
   * 显示弹窗
   * @param content 内容
   */
  show(content) {
    this.contentLabel.getObject().html(content);
    this.popupWindow.show();
  }

  /**
   * 隐藏弹窗
   */
  hide() {
    ////////////////////////////////////////////////////////////////////////////
    // 隐藏弹窗。
    ////////////////////////////////////////////////////////////////////////////
    this.popupWindow.hide();
  }

  /**
   * 显示结果消息
   * @param type 类型（包括：success和error）
   * @param content 内容
   */
  showResultInfo(type, content) {
    ////////////////////////////////////////////////////////////////////////////
    // 移除类型class。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel.getObject().removeClass("gcw_result_info_label_success gcw_result_info_label_error");
    if (Toolkit.stringEqualsIgnoreCase("success", type)) {
      this.resultInfoLabel.getObject().addClass("gcw_result_info_label_success");
    } else {
      this.resultInfoLabel.getObject().addClass("gcw_result_info_label_error");
    }
    ////////////////////////////////////////////////////////////////////////////
    // 设置结果消息内容。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel.getObject().html(content);
    ////////////////////////////////////////////////////////////////////////////
    // 显示结果消息内容。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel.getObject().css("display", "block");
  }

  /**
   * 隐藏结果信息
   */
  hideResultInfo() {
    ////////////////////////////////////////////////////////////////////////////
    // 隐藏结果消息内容。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel.getObject().css("display", "none");
    ////////////////////////////////////////////////////////////////////////////
    // 清空结果消息内容。
    ////////////////////////////////////////////////////////////////////////////
    this.resultInfoLabel.getObject().html("");
  }

  /**
   * 完成
   */
  complete() {
    //////////////////////////////////////////////////////////////////////////
    // 隐藏内容标签。
    //////////////////////////////////////////////////////////////////////////
    this.contentLabel.getObject().css("display", "none");
    ////////////////////////////////////////////////////////////////////////////
    // 隐藏确认按钮。
    ////////////////////////////////////////////////////////////////////////////
    this.confirmButton.getObject().css("display", "none");
    ////////////////////////////////////////////////////////////////////////////
    // 修改取消按钮内容。
    ////////////////////////////////////////////////////////////////////////////
    this.cancelButton.getObject().html("关闭");
  }

  /**
   * 冻结控件
   */
  frozenControl() {
    this.confirmButton.getObject().attr("disabled", "disabled");
    this.cancelButton.getObject().attr("disabled", "disabled");
  }

  /**
   * 恢复控件
   */
  recoverControl() {
    this.confirmButton.getObject().removeAttr("disabled");
    this.cancelButton.getObject().removeAttr("disabled");
  }
}
